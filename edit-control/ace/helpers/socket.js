var fg_iSendMsDelay=0,fg_iReceiveMsDelay=0;define(["require","helpers/helpers-web"],function(e){var t=e("helpers/helpers-web");return t.createClass({_oSocket:null,_oCallbacks:{},_aOutbox:[],_bIsOpen:!1,__init__:function(e){if(e===null)return;this._oSocket=new WebSocket(e),this._oSocket.onmessage=t.createCallback(this,function(e){this._dispatch("message",t.fromJSON(e.data))}),this._oSocket.onopen=t.createCallback(this,function(){this._dispatch("open",null);while(this._aOutbox.length)this._oSocket.send(this._aOutbox.pop());this._bIsOpen=!0}),this._oSocket.onclose=t.createCallback(this,function(){this._dispatch("close",null)})},bind:function(e,n,r){this._oCallbacks[e]=this._oCallbacks[e]||[],this._oCallbacks[e].push(t.createCallback(n,r))},send:function(e,n){if(this._oSocket===null)return;fg_iSendMsDelay>0?window.setTimeout(t.createCallback(this,function(){this._send(e,n)}),fg_iSendMsDelay):this._send(e,n)},_send:function(e,n){var r=t.toJSON({sType:e,oData:n});this._bIsOpen?this._oSocket.send(r):this._aOutbox.push(r)},_dispatch:function(e,n){var r=t.createCallback(this,function(){if(e in this._oCallbacks){var r=!1;for(var i in this._oCallbacks[e])this._oCallbacks[e][i](n)&&(r=!0);t.assert(r,"The event had no listener: "+e)}});fg_iReceiveMsDelay>0?window.setTimeout(r,fg_iReceiveMsDelay):r()}})});